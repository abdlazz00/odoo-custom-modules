<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- ===================== DASHBOARD TEMPLATE ===================== -->
    <t t-name="library_management.Dashboard">
        <div class="o_library_dashboard o_content">
            <h1 class="mb-4 fw-bold">üìä Library Management Dashboard</h1>

            <!-- ===================== KPI CARDS ===================== -->
            <div class="kpi-row">
                <div class="kpi-card" data-icon="üìö">
                    <div class="text-muted"><i class="fa fa-book me-1"/> Total Buku</div>
                    <h3 t-esc="state.kpis.total_books || 0"/>
                </div>
                <div class="kpi-card" data-icon="‚úÖ">
                    <div class="text-muted"><i class="fa fa-check-circle text-success me-1"/> Buku Tersedia</div>
                    <h3 t-esc="state.kpis.available_books || 0"/>
                </div>
                <div class="kpi-card" data-icon="‚ö†Ô∏è">
                    <div class="text-muted"><i class="fa fa-exclamation-circle text-danger me-1"/> Denda Belum Dibayar</div>
                    <h3 t-esc="state.kpis.total_fines_balance || 'Rp 0'"/>
                </div>

                <div class="kpi-card" data-icon="üì¶">
                    <div class="text-muted"><i class="fa fa-layer-group me-1"/> Total Stok Fisik</div>
                    <h3 t-esc="state.kpis.total_stock_books || 0"/>
                </div>
                <div class="kpi-card" data-icon="üìñ">
                    <div class="text-muted"><i class="fa fa-book-reader text-warning me-1"/> Buku Dipinjam</div>
                    <h3 t-esc="state.kpis.borrowed_books || 0"/>
                </div>
                <div class="kpi-card" data-icon="üí∞">
                    <div class="text-muted"><i class="fa fa-money-bill text-success me-1"/> Denda Dibayar</div>
                    <h3 t-esc="state.kpis.total_fines_paid || 'Rp 0'"/>
                </div>
            </div>

            <!-- ===================== CHARTS ===================== -->
            <div class="charts-section mt-4">

                <!-- üìä CHART 1: Bar Chart Peminjaman per Bulan -->
                <div class="chart-row chart-single mb-4">
                    <div class="o_card p-3 chart-bar-card">
                        <h6 class="fw-bold mb-2">üìÖ Peminjaman per Bulan</h6>
                        <div class="chart-container">
                            <canvas id="chartBorrow"></canvas>
                        </div>
                    </div>
                </div>

                <!-- üìà CHART 2 & 3: Pie Charts -->
                <div class="chart-row chart-pair">
                    <div class="o_card p-3">
                        <h6 class="fw-bold mb-2">üìö Distribusi Buku per Kategori</h6>
                        <canvas id="chartCategory"></canvas>
                    </div>
                    <div class="o_card p-3">
                        <h6 class="fw-bold mb-2">üí∞ Status Pembayaran Denda</h6>
                        <canvas id="chartFine"></canvas>
                    </div>
                </div>
            </div>


            <!-- ===================== TABLES ===================== -->
            <div class="tables-row mt-4">
                <div class="o_card p-3">
                    <h6 class="fw-bold mb-3">üì¶ Informasi Stok Buku</h6>
                    <table class="table table-sm table-hover align-middle">
                        <thead>
                            <tr class="text-muted">
                                <th>Judul Buku</th>
                                <th class="text-end">Total Stok</th>
                                <th class="text-end">Dipinjam</th>
                                <th class="text-end fw-bold">Tersedia</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="state.book_stock_list" t-as="book" t-key="book.id">
                                <td><t t-esc="book.name"/></td>
                                <td class="text-end"><t t-esc="book.stock"/></td>
                                <td class="text-end text-warning"><t t-esc="book.borrowed_stock"/></td>
                                <td class="text-end fw-bold text-success"><t t-esc="book.remaining_stock"/></td>
                            </tr>
                            <tr t-if="!state.book_stock_list.length">
                                <td colspan="4" class="text-center text-muted py-3">Tidak ada data buku</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="o_card p-3">
                    <h6 class="fw-bold mb-3">üèÜ Top 10 Anggota Teraktif</h6>
                    <table class="table table-sm table-hover align-middle">
                        <thead>
                            <tr class="text-muted">
                                <th style="width: 5%;">#</th>
                                <th>Nama Anggota</th>
                                <th class="text-end">Jumlah Peminjaman</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="state.top_members_list" t-as="member" t-key="member.id" t-log="member">
                                <td class="fw-bold">
                                    <t t-esc="member_index + 1"/>
                                </td>
                                <td>
                                    <t t-esc="member.name"/>
                                </td>
                                <td class="text-end fw-semibold">
                                    <t t-esc="member.borrow_count"/>
                                </td>
                            </tr>
                            <tr t-if="!state.top_members_list.length">
                                <td colspan="3" class="text-center text-muted py-3">Tidak ada data peminjaman anggota</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ===================== LOADING OVERLAY ===================== -->
            <t t-if="state.loading">
                <div class="o_loading_overlay d-flex justify-content-center align-items-center">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2 text-muted small">Memuat data dashboard...</p>
                    </div>
                </div>
            </t>

        </div>
    </t>

</templates>
