<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- ===================== DASHBOARD TEMPLATE ===================== -->
    <t t-name="library_management.Dashboard">
        <div class="o_library_dashboard o_content">
            <h1 class="mb-4 fw-bold">üìä Library Management Dashboard</h1>

            <!-- ===================== FILTER SECTION ===================== -->
            <div class="filter-section o_card mb-3 p-3">
                <div class="d-flex flex-wrap align-items-center gap-2">
                    <div>
                        <input type="date" id="filter_from" placeholder="From Date" class="form-control form-control-sm"/>
                    </div>
                    <div>
                        <input type="date" id="filter_to" placeholder="End Date" class="form-control form-control-sm"/>
                    </div>
                    <div>
                        <input type="text" id="filter_member" placeholder="Cari anggota..." class="form-control form-control-sm"/>
                    </div>
                    <div class="mt-3 mt-sm-0">
                        <button type="button" t-on-click="applyFilter" class="btn btn-primary btn-sm">
                            <i class="fa fa-filter me-1"/> Terapkan
                        </button>
                    </div>
                </div>
            </div>

            <!-- ===================== KPI CARDS ===================== -->
            <div class="kpi-row">

                <div class="kpi-card" data-icon="üìö">
                    <div class="text-muted"><i class="fa fa-book me-1"/> Total Buku</div>
                    <h3 t-esc="state.kpis.total_books || 0"/>
                </div>

                <div class="kpi-card" data-icon="üì¶">
                    <div class="text-muted"><i class="fa fa-layer-group me-1"/> Total Stok Buku</div>
                    <h3 t-esc="state.kpis.total_stock_books || 0"/>
                </div>

                <div class="kpi-card" data-icon="‚úÖ">
                    <div class="text-muted"><i class="fa fa-check-circle text-success me-1"/> Buku Tersedia</div>
                    <h3 t-esc="state.kpis.available_books || 0"/>
                </div>

                <div class="kpi-card" data-icon="üìñ">
                    <div class="text-muted"><i class="fa fa-book-reader text-warning me-1"/> Buku Dipinjam</div>
                    <h3 t-esc="state.kpis.borrowed_books || 0"/>
                </div>

                <div class="kpi-card" data-icon="üí∞">
                    <div class="text-muted"><i class="fa fa-money-bill text-success me-1"/> Denda Dibayar</div>
                    <h3 t-esc="state.kpis.total_fines_paid || 'Rp 0'"/>
                </div>

                <div class="kpi-card" data-icon="‚ö†Ô∏è">
                    <div class="text-muted"><i class="fa fa-exclamation-circle text-danger me-1"/> Denda Belum Dibayar</div>
                    <h3 t-esc="state.kpis.total_fines_balance || 'Rp 0'"/>
                </div>

            </div>


            <!-- ===================== CHARTS ===================== -->
            <div class="charts-section mt-4">

                <!-- üìä CHART 1: Bar Chart Peminjaman per Bulan -->
                <div class="chart-row chart-single mb-4">
                    <div class="o_card p-3 chart-bar-card">
                        <h6 class="fw-bold mb-2">üìÖ Peminjaman per Bulan</h6>
                        <div class="chart-container">
                            <canvas id="chartBorrow"></canvas>
                        </div>
                    </div>
                </div>

                <!-- üìà CHART 2 & 3: Pie Charts -->
                <div class="chart-row chart-pair">
                    <div class="o_card p-3">
                        <h6 class="fw-bold mb-2">üìö Distribusi Buku per Kategori</h6>
                        <canvas id="chartCategory"></canvas>
                    </div>
                    <div class="o_card p-3">
                        <h6 class="fw-bold mb-2">üí∞ Status Pembayaran Denda</h6>
                        <canvas id="chartFine"></canvas>
                    </div>
                </div>
            </div>


            <!-- ===================== TABLES ===================== -->
            <div class="tables-row mt-4">
                <div class="o_card p-3">
                    <h6 class="fw-bold mb-3">üèÜ Buku Paling Sering Dipinjam</h6>
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Judul Buku</th>
                                <th class="text-end">Jumlah Dipinjam</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="state.top_books" t-as="book" t-key="book.id">
                                <td><t t-esc="book.name"/></td>
                                <td class="text-end fw-semibold"><t t-esc="book.qty"/></td>
                            </tr>
                            <tr t-if="!state.top_books.length">
                                <td colspan="2" class="text-center text-muted">Tidak ada data buku</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="o_card p-3">
                    <h6 class="fw-bold mb-3">üë• Anggota Paling Aktif</h6>
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Nama Anggota</th>
                                <th class="text-end">Jumlah Peminjaman</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="state.top_members" t-as="member" t-key="member.id">
                                <td><t t-esc="member.name"/></td>
                                <td class="text-end fw-semibold"><t t-esc="member.qty"/></td>
                            </tr>
                            <tr t-if="!state.top_members.length">
                                <td colspan="2" class="text-center text-muted">Tidak ada data anggota</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ===================== LOADING OVERLAY ===================== -->
            <t t-if="state.loading">
                <div class="o_loading_overlay d-flex justify-content-center align-items-center">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2 text-muted small">Memuat data dashboard...</p>
                    </div>
                </div>
            </t>

        </div>
    </t>

</templates>
